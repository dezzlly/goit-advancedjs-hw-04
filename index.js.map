{"version":3,"file":"index.js","sources":["../src/js/pixabay-api.js","../src/js/render-functions.js","../src/main.js"],"sourcesContent":["import axios from 'axios';\n\nconst API_KEY = '52905819-433962418f10cc5e4a65a61ca'; \nconst PER_PAGE = 15;\n\nconst api = axios.create({\n  baseURL: 'https://pixabay.com/api/',\n  timeout: 10000,\n  params: {\n    key: API_KEY,\n    image_type: 'photo',\n    orientation: 'horizontal',\n    safesearch: true,\n  },\n});\n\n/**\n * Отримати зображення з пагінацією.\n * @param {string} query - пошукова фраза\n * @param {number} page  - номер сторінки (1..N)\n * @param {number} perPage - скільки елементів за раз (за вимогою — 15)\n * @returns {Promise<{hits: any[], totalHits: number}>}\n */\nexport async function fetchImages(query, page = 1, perPage = PER_PAGE) {\n  const { data } = await api.get('', {\n    params: {\n      q: query,\n      page,\n      per_page: perPage,\n    },\n  });\n  return data; \n}\n\n/**\n * Перевірка, чи є ще сторінки для поточного запиту.\n */\nexport function hasMore({ page, perPage = PER_PAGE, totalHits }) {\n  const alreadyLoaded = page * perPage;\n  return alreadyLoaded < totalHits;\n}\n\nexport { PER_PAGE };\n","export function buildGalleryMarkup(hits) {\n  return hits\n    .map(\n      ({\n        webformatURL,\n        largeImageURL,\n        tags,\n        likes,\n        views,\n        comments,\n        downloads,\n      }) => `\n<li class=\"photo-card\">\n  <a class=\"gallery__link\" href=\"${largeImageURL}\">\n    <img class=\"gallery__image\" src=\"${webformatURL}\" alt=\"${escapeHtml(\n          tags\n        )}\" loading=\"lazy\" />\n  </a>\n  <ul class=\"info\">\n    <li><span>Likes</span><b>${likes}</b></li>\n    <li><span>Views</span><b>${views}</b></li>\n    <li><span>Comments</span><b>${comments}</b></li>\n    <li><span>Downloads</span><b>${downloads}</b></li>\n  </ul>\n</li>`\n    )\n    .join('');\n}\n\nexport function clearGallery(listEl) {\n  listEl.innerHTML = '';\n}\n\nexport function appendToGallery(listEl, markup) {\n  if (!markup) return;\n  listEl.insertAdjacentHTML('beforeend', markup);\n}\n\nexport function show(el) {\n  el.classList.remove('is-hidden');\n}\nexport function hide(el) {\n  el.classList.add('is-hidden');\n}\n\nexport function setBusy(el, busy = true) {\n  el.disabled = busy;\n  el.setAttribute('aria-busy', String(busy));\n}\n\nexport function setMessage(msgEl, text = '') {\n  msgEl.textContent = text;\n}\n\nfunction escapeHtml(str = '') {\n  return str.replace(/[&<>\"']/g, s => ({ '&':'&amp;','<':'&lt;','>':'&gt;','\"':'&quot;',\"'\":'&#39;' }[s]));\n}\n","import SimpleLightbox from 'simplelightbox';\nimport 'simplelightbox/dist/simple-lightbox.min.css';\nimport '../src/css/styles.css';\n\nimport { fetchImages, hasMore, PER_PAGE } from './js/pixabay-api.js';\nimport {\n  buildGalleryMarkup,\n  clearGallery,\n  appendToGallery,\n  show,\n  hide,\n  setBusy,\n  setMessage,\n} from './js/render-functions.js';\n\n\nconst refs = {\n  form: document.querySelector('#search-form'),\n  input: document.querySelector('#query'),\n  gallery: document.querySelector('.gallery'),\n  loadMoreBtn: document.querySelector('#load-more'),\n  loader: document.querySelector('#loader'),\n  message: document.querySelector('#message'),\n};\n\nlet state = {\n  query: '',\n  page: 1,\n  totalHits: 0,\n  isLoading: false,\n};\n\nconst lightbox = new SimpleLightbox('.gallery a', {\n  captions: true,\n  captionsData: 'alt',\n  captionDelay: 250,\n});\n\n\nhide(refs.loadMoreBtn);\nhide(refs.loader);\n\nrefs.form.addEventListener('submit', onSearch);\nrefs.loadMoreBtn.addEventListener('click', onLoadMore);\n\nasync function onSearch(e) {\n  e.preventDefault();\n  const q = refs.input.value.trim();\n\n \n  state.query = q;\n  state.page = 1;\n  state.totalHits = 0;\n  setMessage(refs.message, '');\n  hide(refs.loadMoreBtn);\n  clearGallery(refs.gallery);\n\n  if (!q) {\n    setMessage(refs.message, 'Please enter a search term.');\n    return;\n  }\n\n  await loadImages(); \n}\n\nasync function onLoadMore() {\n  await loadImages(true); \n}\n\n/**\n * Загальний загрузник сторінок\n * @param {boolean} isNextPage\n */\nasync function loadImages(isNextPage = false) {\n  if (state.isLoading) return;\n\n  try {\n    state.isLoading = true;\n    setBusy(refs.loadMoreBtn, true);\n    show(refs.loader); \n\n    const data = await fetchImages(state.query, state.page, PER_PAGE);\n    const { hits, totalHits } = data;\n    state.totalHits = totalHits;\n\n    if (hits.length === 0 && state.page === 1) {\n      setMessage(refs.message, 'Sorry, there are no images matching your search query.');\n      hide(refs.loadMoreBtn);\n      return;\n    }\n\n   \n    const markup = buildGalleryMarkup(hits);\n    appendToGallery(refs.gallery, markup);\n    lightbox.refresh();\n\n  \n    const more = hasMore({\n      page: state.page,\n      perPage: PER_PAGE,\n      totalHits: state.totalHits,\n    });\n\n    if (more) {\n      show(refs.loadMoreBtn);\n    } else {\n      hide(refs.loadMoreBtn);\n      setMessage(\n        refs.message,\n        \"We're sorry, but you've reached the end of search results.\"\n      );\n    }\n\n    \n    if (isNextPage) {\n      const firstCard = document.querySelector('.gallery .photo-card');\n      if (firstCard) {\n        const { height } = firstCard.getBoundingClientRect();\n        window.scrollBy({ top: height * 2, behavior: 'smooth' });\n      }\n    }\n\n    \n    state.page += 1;\n  } catch (err) {\n    console.error(err);\n    setMessage(refs.message, 'Unexpected error. Please try again later.');\n  } finally {\n    state.isLoading = false;\n    hide(refs.loader);\n    setBusy(refs.loadMoreBtn, false);\n  }\n}\n"],"names":["API_KEY","PER_PAGE","api","axios","fetchImages","query","page","perPage","data","hasMore","totalHits","buildGalleryMarkup","hits","webformatURL","largeImageURL","tags","likes","views","comments","downloads","escapeHtml","clearGallery","listEl","appendToGallery","markup","show","el","hide","setBusy","busy","setMessage","msgEl","text","str","s","refs","state","lightbox","SimpleLightbox","onSearch","onLoadMore","e","q","loadImages","isNextPage","firstCard","height","err"],"mappings":"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"}