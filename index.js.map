{"version":3,"file":"index.js","sources":["../src/js/pixabay-api.js","../src/js/render-functions.js","../src/main.js"],"sourcesContent":["import axios from 'axios';\n\nconst API_KEY = '52905819-433962418f10cc5e4a65a61ca'; \nconst PER_PAGE = 15;\n\nconst api = axios.create({\n  baseURL: 'https://pixabay.com/api/',\n  timeout: 10000,\n  params: {\n    key: API_KEY,\n    image_type: 'photo',\n    orientation: 'horizontal',\n    safesearch: true,\n  },\n});\n\n/**\n * Отримати зображення з пагінацією.\n * @param {string} query - пошукова фраза\n * @param {number} page  - номер сторінки (1..N)\n * @param {number} perPage - скільки елементів за раз (за вимогою — 15)\n * @returns {Promise<{hits: any[], totalHits: number}>}\n */\nexport async function fetchImages(query, page = 1, perPage = PER_PAGE) {\n  const { data } = await api.get('', {\n    params: {\n      q: query,\n      page,\n      per_page: perPage,\n    },\n  });\n  return data; \n}\n\n/**\n * Перевірка, чи є ще сторінки для поточного запиту.\n */\nexport function hasMore({ page, perPage = PER_PAGE, totalHits }) {\n  const alreadyLoaded = page * perPage;\n  return alreadyLoaded < totalHits;\n}\n\nexport { PER_PAGE };\n","export function buildGalleryMarkup(hits) {\n  return hits\n    .map(\n      ({\n        webformatURL,\n        largeImageURL,\n        tags,\n        likes,\n        views,\n        comments,\n        downloads,\n      }) => `\n<li class=\"photo-card\">\n  <a class=\"gallery__link\" href=\"${largeImageURL}\">\n    <img class=\"gallery__image\" src=\"${webformatURL}\" alt=\"${escapeHtml(\n          tags\n        )}\" loading=\"lazy\" />\n  </a>\n  <ul class=\"info\">\n    <li><span>Likes</span><b>${likes}</b></li>\n    <li><span>Views</span><b>${views}</b></li>\n    <li><span>Comments</span><b>${comments}</b></li>\n    <li><span>Downloads</span><b>${downloads}</b></li>\n  </ul>\n</li>`\n    )\n    .join('');\n}\n\nexport function clearGallery(listEl) {\n  listEl.innerHTML = '';\n}\n\nexport function appendToGallery(listEl, markup) {\n  if (!markup) return;\n  listEl.insertAdjacentHTML('beforeend', markup);\n}\n\nexport function show(el) {\n  el.classList.remove('is-hidden');\n}\nexport function hide(el) {\n  el.classList.add('is-hidden');\n}\n\nexport function setBusy(el, busy = true) {\n  el.disabled = busy;\n  el.setAttribute('aria-busy', String(busy));\n}\n\nexport function setMessage(msgEl, text = '') {\n  msgEl.textContent = text;\n}\n\nfunction escapeHtml(str = '') {\n  return str.replace(/[&<>\"']/g, s => ({ '&':'&amp;','<':'&lt;','>':'&gt;','\"':'&quot;',\"'\":'&#39;' }[s]));\n}\n","import SimpleLightbox from 'simplelightbox';\nimport 'simplelightbox/dist/simple-lightbox.min.css';\nimport '../src/css/styles.css';\nimport 'izitoast/dist/css/iziToast.min.css';\nimport iziToast from 'izitoast';\nimport { fetchImages, hasMore, PER_PAGE } from '../src/js/pixabay-api.js';\nimport {\n  buildGalleryMarkup,\n  clearGallery,\n  appendToGallery,\n  show,\n  hide,\n  setBusy,\n  setMessage,\n} from '../src/js/render-functions.js';\n\nfunction notifySuccess(message) {\n  iziToast.success({ message, position: 'topRight', timeout: 2500 });\n}\nfunction notifyInfo(message) {\n  iziToast.info({ message, position: 'topRight', timeout: 3000 });\n}\nfunction notifyError(message) {\n  iziToast.error({ message, position: 'topRight', timeout: 3500 });\n}\n\nlet refs = {};\nlet state = {\n  query: '',\n  page: 1,\n  totalHits: 0,\n  isLoading: false,\n};\nlet lightbox;\n\ndocument.addEventListener('DOMContentLoaded', () => {\n  refs = {\n    form: document.querySelector('form.form') || document.querySelector('#search-form'),\n    input: document.querySelector('#query'),\n    gallery: document.querySelector('.gallery'),\n    loadMoreBtn: document.querySelector('#load-more'),\n    loader: document.querySelector('.loader'),\n    message: document.querySelector('#message'),\n  };\n\n  lightbox = new SimpleLightbox('.gallery a', {\n    captions: true,\n    captionsData: 'alt',\n    captionDelay: 250,\n  });\n\n  if (refs.loadMoreBtn) hide(refs.loadMoreBtn);\n  if (refs.loader) hide(refs.loader);\n\n  if (!refs.form) {\n    console.error('Form element not found. Add class=\"form\" or id=\"search-form\".');\n    return;\n  }\n\n  refs.form.addEventListener('submit', onSearch);\n  refs.loadMoreBtn?.addEventListener('click', onLoadMore);\n});\n\nasync function onSearch(e) {\n  e.preventDefault();\n  const q = refs.input.value.trim();\n  state.query = q;\n  state.page = 1;\n  state.totalHits = 0;\n  setMessage(refs.message, '');\n  hide(refs.loadMoreBtn);\n  clearGallery(refs.gallery);\n  if (!q) {\n    notifyError('Please enter a search term.');\n    return;\n  }\n  await loadImages();\n}\n\nasync function onLoadMore() {\n  await loadImages(true);\n}\n\nasync function loadImages(isNextPage = false) {\n  if (state.isLoading) return;\n  try {\n    state.isLoading = true;\n    setBusy(refs.loadMoreBtn, true);\n    show(refs.loader);\n\n    const data = await fetchImages(state.query, state.page, PER_PAGE);\n    const { hits, totalHits } = data;\n    state.totalHits = totalHits;\n\n    if (hits.length === 0 && state.page === 1) {\n      notifyInfo('No images found for your search query.');\n      hide(refs.loadMoreBtn);\n      return;\n    }\n\n    if (state.page === 1) {\n      notifySuccess(`Found ${totalHits} images.`);\n    }\n\n    const markup = buildGalleryMarkup(hits);\n    appendToGallery(refs.gallery, markup);\n    lightbox.refresh();\n\n    const more = hasMore({\n      page: state.page,\n      perPage: PER_PAGE,\n      totalHits: state.totalHits,\n    });\n\n    if (more) {\n      show(refs.loadMoreBtn);\n    } else {\n      hide(refs.loadMoreBtn);\n      setMessage(\n        refs.message,\n        \"We're sorry, but you've reached the end of search results.\"\n      );\n      notifyInfo(\"You've reached the end of search results.\");\n    }\n\n    if (isNextPage) {\n      const firstCard = document.querySelector('.gallery .photo-card');\n      if (firstCard) {\n        const { height } = firstCard.getBoundingClientRect();\n        window.scrollBy({ top: height * 2, behavior: 'smooth' });\n      }\n    }\n\n    state.page += 1;\n  } catch (err) {\n    console.error(err);\n    setMessage(refs.message, 'Unexpected error. Please try again later.');\n    notifyError('Unexpected error. Please try again later.');\n  } finally {\n    state.isLoading = false;\n    hide(refs.loader);\n    setBusy(refs.loadMoreBtn, false);\n  }\n}\n"],"names":["API_KEY","PER_PAGE","api","axios","fetchImages","query","page","perPage","data","hasMore","totalHits","buildGalleryMarkup","hits","webformatURL","largeImageURL","tags","likes","views","comments","downloads","escapeHtml","clearGallery","listEl","appendToGallery","markup","show","el","hide","setBusy","busy","setMessage","msgEl","text","str","s","notifySuccess","message","iziToast","notifyInfo","notifyError","refs","state","lightbox","SimpleLightbox","onSearch","_a","onLoadMore","q","loadImages","isNextPage","firstCard","height","err"],"mappings":"owBAEA,MAAMA,EAAU,qCACVC,EAAW,GAEXC,EAAMC,EAAM,OAAO,CACvB,QAAS,2BACT,QAAS,IACT,OAAQ,CACN,IAAKH,EACL,WAAY,QACZ,YAAa,aACb,WAAY,EACb,CACH,CAAC,EASM,eAAeI,EAAYC,EAAOC,EAAO,EAAGC,EAAUN,EAAU,CACrE,KAAM,CAAE,KAAAO,CAAM,EAAG,MAAMN,EAAI,IAAI,GAAI,CACjC,OAAQ,CACN,EAAGG,EACH,KAAAC,EACA,SAAUC,CACX,CACL,CAAG,EACD,OAAOC,CACT,CAKO,SAASC,EAAQ,CAAE,KAAAH,EAAM,QAAAC,EAAUN,EAAU,UAAAS,CAAS,EAAI,CAE/D,OADsBJ,EAAOC,EACNG,CACzB,CCxCO,SAASC,EAAmBC,EAAM,CACvC,OAAOA,EACJ,IACC,CAAC,CACC,aAAAC,EACA,cAAAC,EACA,KAAAC,EACA,MAAAC,EACA,MAAAC,EACA,SAAAC,EACA,UAAAC,CACR,IAAY;AAAA;AAAA,mCAEuBL,CAAa;AAAA,uCACTD,CAAY,UAAUO,EACnDL,CACV,CAAS;AAAA;AAAA;AAAA,+BAGsBC,CAAK;AAAA,+BACLC,CAAK;AAAA,kCACFC,CAAQ;AAAA,mCACPC,CAAS;AAAA;AAAA,MAGvC,EACA,KAAK,EAAE,CACZ,CAEO,SAASE,EAAaC,EAAQ,CACnCA,EAAO,UAAY,EACrB,CAEO,SAASC,EAAgBD,EAAQE,EAAQ,CACzCA,GACLF,EAAO,mBAAmB,YAAaE,CAAM,CAC/C,CAEO,SAASC,EAAKC,EAAI,CACvBA,EAAG,UAAU,OAAO,WAAW,CACjC,CACO,SAASC,EAAKD,EAAI,CACvBA,EAAG,UAAU,IAAI,WAAW,CAC9B,CAEO,SAASE,EAAQF,EAAIG,EAAO,GAAM,CACvCH,EAAG,SAAWG,EACdH,EAAG,aAAa,YAAa,OAAOG,CAAI,CAAC,CAC3C,CAEO,SAASC,EAAWC,EAAOC,EAAO,GAAI,CAC3CD,EAAM,YAAcC,CACtB,CAEA,SAASZ,EAAWa,EAAM,GAAI,CAC5B,OAAOA,EAAI,QAAQ,WAAYC,IAAM,CAAE,IAAI,QAAQ,IAAI,OAAO,IAAI,OAAO,IAAI,SAAS,IAAI,UAAUA,CAAC,CAAE,CACzG,CCxCA,SAASC,EAAcC,EAAS,CAC9BC,EAAS,QAAQ,CAAE,QAAAD,EAAS,SAAU,WAAY,QAAS,IAAI,CAAE,CACnE,CACA,SAASE,EAAWF,EAAS,CAC3BC,EAAS,KAAK,CAAE,QAAAD,EAAS,SAAU,WAAY,QAAS,GAAI,CAAE,CAChE,CACA,SAASG,EAAYH,EAAS,CAC5BC,EAAS,MAAM,CAAE,QAAAD,EAAS,SAAU,WAAY,QAAS,IAAI,CAAE,CACjE,CAEA,IAAII,EAAO,CAAA,EACPC,EAAQ,CACV,MAAO,GACP,KAAM,EACN,UAAW,EACX,UAAW,EACb,EACIC,EAEJ,SAAS,iBAAiB,mBAAoB,IAAM,OAmBlD,GAlBAF,EAAO,CACL,KAAM,SAAS,cAAc,WAAW,GAAK,SAAS,cAAc,cAAc,EAClF,MAAO,SAAS,cAAc,QAAQ,EACtC,QAAS,SAAS,cAAc,UAAU,EAC1C,YAAa,SAAS,cAAc,YAAY,EAChD,OAAQ,SAAS,cAAc,SAAS,EACxC,QAAS,SAAS,cAAc,UAAU,CAC9C,EAEEE,EAAW,IAAIC,EAAe,aAAc,CAC1C,SAAU,GACV,aAAc,MACd,aAAc,GAClB,CAAG,EAEGH,EAAK,aAAab,EAAKa,EAAK,WAAW,EACvCA,EAAK,QAAQb,EAAKa,EAAK,MAAM,EAE7B,CAACA,EAAK,KAAM,CACd,QAAQ,MAAM,+DAA+D,EAC7E,MACD,CAEDA,EAAK,KAAK,iBAAiB,SAAUI,CAAQ,GAC7CC,EAAAL,EAAK,cAAL,MAAAK,EAAkB,iBAAiB,QAASC,EAC9C,CAAC,EAED,eAAeF,EAAS,EAAG,CACzB,EAAE,eAAc,EAChB,MAAMG,EAAIP,EAAK,MAAM,MAAM,KAAI,EAO/B,GANAC,EAAM,MAAQM,EACdN,EAAM,KAAO,EACbA,EAAM,UAAY,EAClBX,EAAWU,EAAK,QAAS,EAAE,EAC3Bb,EAAKa,EAAK,WAAW,EACrBnB,EAAamB,EAAK,OAAO,EACrB,CAACO,EAAG,CACNR,EAAY,6BAA6B,EACzC,MACD,CACD,MAAMS,EAAU,CAClB,CAEA,eAAeF,GAAa,CAC1B,MAAME,EAAW,EAAI,CACvB,CAEA,eAAeA,EAAWC,EAAa,GAAO,CAC5C,GAAI,CAAAR,EAAM,UACV,GAAI,CACFA,EAAM,UAAY,GAClBb,EAAQY,EAAK,YAAa,EAAI,EAC9Bf,EAAKe,EAAK,MAAM,EAEhB,MAAMhC,EAAO,MAAMJ,EAAYqC,EAAM,MAAOA,EAAM,KAAMxC,CAAQ,EAC1D,CAAE,KAAAW,EAAM,UAAAF,CAAW,EAAGF,EAG5B,GAFAiC,EAAM,UAAY/B,EAEdE,EAAK,SAAW,GAAK6B,EAAM,OAAS,EAAG,CACzCH,EAAW,wCAAwC,EACnDX,EAAKa,EAAK,WAAW,EACrB,MACD,CAEGC,EAAM,OAAS,GACjBN,EAAc,SAASzB,CAAS,UAAU,EAG5C,MAAMc,EAASb,EAAmBC,CAAI,EAqBtC,GApBAW,EAAgBiB,EAAK,QAAShB,CAAM,EACpCkB,EAAS,QAAO,EAEHjC,EAAQ,CACnB,KAAMgC,EAAM,KACZ,QAASxC,EACT,UAAWwC,EAAM,SACvB,CAAK,EAGChB,EAAKe,EAAK,WAAW,GAErBb,EAAKa,EAAK,WAAW,EACrBV,EACEU,EAAK,QACL,4DACR,EACMF,EAAW,2CAA2C,GAGpDW,EAAY,CACd,MAAMC,EAAY,SAAS,cAAc,sBAAsB,EAC/D,GAAIA,EAAW,CACb,KAAM,CAAE,OAAAC,CAAM,EAAKD,EAAU,sBAAqB,EAClD,OAAO,SAAS,CAAE,IAAKC,EAAS,EAAG,SAAU,QAAQ,CAAE,CACxD,CACF,CAEDV,EAAM,MAAQ,CACf,OAAQW,EAAK,CACZ,QAAQ,MAAMA,CAAG,EACjBtB,EAAWU,EAAK,QAAS,2CAA2C,EACpED,EAAY,2CAA2C,CAC3D,QAAY,CACRE,EAAM,UAAY,GAClBd,EAAKa,EAAK,MAAM,EAChBZ,EAAQY,EAAK,YAAa,EAAK,CAChC,CACH"}